{% block content %}

<link rel="stylesheet" href="/static/css/style.css">
<link rel="stylesheet" href="/static/css/chat.css">

<div class="chat-container">
    <div class="chat-header">
        <div class="chat-avatar">
            <img src="/static/images/avatar1.png" alt="User Avatar">
        </div>
        <h2 class="chat-name">{{ sender }}</h2>
    </div>

    <div class="chat-messages">
{% for message in messages %}
    <div class="message {% if message[6] == 'sent' %}message-sent{% else %}message-received{% endif %}">
        <p class="message-text">{{ message[3] }}</p>
        <div class="message-footer">
            <span class="message-time">{{ message[5] }}</span>
            {% if message[6] == 'sent' %}
                <span class="message-status">
                    {% if message[4] == 'undelivered' %}
                        ✓
                    {% elif message[4] == 'delivered' %}
                        ✓✓
                    {% elif message[4] == 'read' %}
                        ✓✓ (read)
                    {% endif %}
                </span>
            {% endif %}
        </div>
    </div>
{% endfor %}
    </div>

    <div class="chat-input-container">
        <form id="chat-form">
            <input type="hidden" name="recipient_userName" value="{{ sender }}">
            <input type="text" id="message-input" name="message" class="chat-input" placeholder="Escribe tu mensaje..." required>
            <button type="submit" class="chat-send-button">Enviar</button>
        </form>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {

        $("#chat-form").submit(function (event) {
            event.preventDefault(); 

      
            $.ajax({
                url: "/sendMessage",
                type: "POST",
                data: $(this).serialize(), 
                success: function (response) {
                    if (response.error) {
                        alert(response.error);  
                    } else {
                     
                        $(".chat-messages").html(response.messages);
                        $("#message-input").val("");  
                    }
                },
                error: function () {
                    alert("Hubo un error al enviar el mensaje.");
                }
            });
        });
    });
</script>

{% endblock content %}
